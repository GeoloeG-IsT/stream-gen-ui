---
plan: 01-01
title: Move frontend code to frontend/ directory with configuration updates
wave: 1
depends_on: []
files_modified:
  - frontend/app/**/*
  - frontend/components/**/*
  - frontend/contexts/**/*
  - frontend/lib/**/*
  - frontend/types/**/*
  - frontend/public/**/*
  - frontend/vitest.setup.ts
  - frontend/next-env.d.ts
  - tsconfig.json
  - vitest.config.ts
  - .gitignore
  - eslint.config.mjs
  - .planning/codebase/STRUCTURE.md
  - .planning/codebase/ARCHITECTURE.md
  - .planning/codebase/CONVENTIONS.md
  - .planning/codebase/TESTING.md
  - .planning/codebase/STACK.md
autonomous: true
---

# Move Frontend Code to frontend/ Directory

## Objective

Reorganize the codebase to separate frontend application code into a `frontend/` subdirectory while keeping configuration files at repository root. This creates a clean structure for adding a Python backend in Phase 2.

**Purpose:** Enable frontend/backend separation by moving all Next.js application code (app/, components/, contexts/, lib/, types/, public/) into a dedicated frontend/ directory.

**Output:** Working Next.js build from the new structure with all paths correctly updated.

## must_haves

**truths:**
- All Next.js source files exist under frontend/ directory with correct structure
- Frontend builds successfully from frontend/ directory without errors
- Frontend development server runs and renders existing streaming UI components
- All import paths and configuration files reference correct locations
- All tests pass with updated paths

**artifacts:**
- path: "frontend/app/page.tsx"
  provides: "Root page redirect"
- path: "frontend/components/shared/MessageBubble.tsx"
  provides: "Message display component"
- path: "frontend/contexts/ViewRawContext.tsx"
  provides: "Global state context"
- path: "tsconfig.json"
  provides: "Updated TypeScript path aliases"
- path: "vitest.config.ts"
  provides: "Updated test configuration"

**key_links:**
- from: "tsconfig.json"
  to: "frontend/*"
  via: "paths[\"@/*\"]"
  pattern: "\"@/\\*\": \\[\"\\./frontend/\\*\"\\]"
- from: "vitest.config.ts"
  to: "frontend/vitest.setup.ts"
  via: "setupFiles"
  pattern: "./frontend/vitest.setup.ts"

## Context

@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-frontend-reorganization/01-RESEARCH.md

## Tasks

<task id="1">
<title>Create frontend/ directory and move application code</title>
<instruction>
Create the frontend/ directory and move all application code atomically:

1. Create frontend directory:
```bash
mkdir frontend
```

2. Move all application directories and files:
```bash
mv app frontend/
mv components frontend/
mv contexts frontend/
mv lib frontend/
mv types frontend/
mv public frontend/
mv vitest.setup.ts frontend/
mv next-env.d.ts frontend/
```

Files being moved:
- app/ - Next.js App Router pages and API routes (39 files)
- components/ - React components in flowtoken/, llm-ui/, streamdown/, shared/ (20 files)
- contexts/ - ViewRawContext.tsx and test
- lib/ - utils.ts, mock-stream.ts, test-content.ts and tests
- types/ - index.ts type definitions
- public/ - Static assets (svg files)
- vitest.setup.ts - Test setup file
- next-env.d.ts - Next.js TypeScript declarations

Do NOT move:
- package.json (stays at root)
- tsconfig.json (stays at root, will be updated)
- next.config.ts (stays at root)
- vitest.config.ts (stays at root, will be updated)
- eslint.config.mjs (stays at root, will be updated)
- postcss.config.mjs (stays at root, no changes needed)
- .gitignore (stays at root, will be updated)
- node_modules/ (stays at root)
- .next/ (build output, stays at root)
</instruction>
<verification>
Run: `ls -la frontend/` - Should show app/, components/, contexts/, lib/, types/, public/, vitest.setup.ts, next-env.d.ts
Run: `ls app/ 2>/dev/null || echo "app/ moved successfully"` - Should confirm original directories no longer exist at root
</verification>
</task>

<task id="2">
<title>Update tsconfig.json path aliases and include patterns</title>
<instruction>
Update tsconfig.json to reference the new frontend/ directory:

1. Update compilerOptions.paths to point @/* to frontend/*:
```json
"paths": {
  "@/*": ["./frontend/*"]
}
```

2. Update include array to reference frontend/ subdirectory:
```json
"include": [
  "frontend/next-env.d.ts",
  "frontend/**/*.ts",
  "frontend/**/*.tsx",
  "frontend/**/*.mts",
  ".next/types/**/*.ts",
  ".next/dev/types/**/*.ts"
]
```

The baseUrl stays as "." (repository root).
The exclude stays as ["node_modules"].

Full tsconfig.json after update:
```json
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noImplicitAny": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./frontend/*"]
    }
  },
  "include": [
    "frontend/next-env.d.ts",
    "frontend/**/*.ts",
    "frontend/**/*.tsx",
    "frontend/**/*.mts",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts"
  ],
  "exclude": ["node_modules"]
}
```
</instruction>
<verification>
Run: `npx tsc --noEmit` - Should complete with no errors (TypeScript can find all files)
</verification>
</task>

<task id="3">
<title>Update vitest.config.ts for new paths</title>
<instruction>
Update vitest.config.ts to reference the new frontend/ directory:

1. Update setupFiles path to frontend/vitest.setup.ts
2. Update resolve.alias to point @ to ./frontend

Full vitest.config.ts after update:
```typescript
import react from '@vitejs/plugin-react';
import { resolve } from 'path';
import { defineConfig } from 'vitest/config';

export default defineConfig({
  plugins: [react()],
  test: {
    environment: 'jsdom',
    globals: true,
    setupFiles: ['./frontend/vitest.setup.ts'],
  },
  resolve: {
    alias: {
      '@': resolve(__dirname, './frontend'),
    },
  },
});
```
</instruction>
<verification>
Run: `npm test` - All tests should pass (16 test files)
</verification>
</task>

<task id="4">
<title>Update .gitignore and eslint.config.mjs</title>
<instruction>
Update .gitignore to handle frontend/ paths. The current patterns use relative paths which should still work, but verify:

Current .gitignore patterns that may need attention:
- `/.next/` - This is root-relative, .next/ stays at root, so NO CHANGE needed
- `/coverage` - Coverage stays at root, so NO CHANGE needed

The existing patterns should work correctly because:
- .next/ output stays at repository root (Next.js default)
- node_modules/ stays at repository root
- No new gitignore patterns needed for frontend/

**eslint.config.mjs** - Check if any path updates needed:

Current globalIgnores:
```javascript
globalIgnores([
  ".next/**",
  "out/**",
  "build/**",
  "next-env.d.ts",
])
```

Update to include frontend/ path for next-env.d.ts:
```javascript
globalIgnores([
  ".next/**",
  "out/**",
  "build/**",
  "next-env.d.ts",
  "frontend/next-env.d.ts",
])
```

Full eslint.config.mjs after update:
```javascript
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
    "frontend/next-env.d.ts",
  ]),
]);

export default eslintConfig;
```
</instruction>
<verification>
Run: `npm run lint` - Should complete with no errors
Run: `git status` - Verify .gitignore is properly ignoring .next/ and node_modules/
</verification>
</task>

<task id="5">
<title>Verify build and dev server work correctly</title>
<instruction>
Run full verification of the reorganized structure:

1. Clean any stale build artifacts:
```bash
rm -rf .next
```

2. Run production build:
```bash
npm run build
```
Expected: Build completes successfully, outputs to .next/ directory

3. Start development server and verify it works:
```bash
npm run dev
```
Expected: Server starts on localhost:3000

4. Manually verify (or use curl) that pages load:
- http://localhost:3000 - Should redirect to /flowtoken
- http://localhost:3000/flowtoken - Should render FlowToken demo
- http://localhost:3000/llm-ui - Should render llm-ui demo
- http://localhost:3000/streamdown - Should render Streamdown demo

5. Verify API endpoint works:
```bash
curl -X POST http://localhost:3000/api/chat \
  -H "Content-Type: application/json" \
  -d '{"messages":[{"role":"user","content":"hello"}]}'
```
Expected: Returns streaming response
</instruction>
<verification>
Run: `npm run build` - Should complete with "Compiled successfully"
Run: `npm test` - All 16 test files should pass
</verification>
</task>

<task id="6">
<title>Update documentation paths in .planning/codebase/*.md</title>
<instruction>
Update all path references in codebase documentation to reflect the new frontend/ structure.

Files to update:
1. .planning/codebase/STRUCTURE.md - Update directory layout diagram and all path references
2. .planning/codebase/ARCHITECTURE.md - Update layer locations and entry point paths
3. .planning/codebase/CONVENTIONS.md - Update path alias documentation
4. .planning/codebase/TESTING.md - Update test file location examples
5. .planning/codebase/STACK.md - Update configuration file descriptions

Key changes in each file:

**STRUCTURE.md:**
- Update directory layout to show frontend/ as parent of app/, components/, etc.
- Change all "app/" references to "frontend/app/"
- Change all "components/" references to "frontend/components/"
- Change all "contexts/" references to "frontend/contexts/"
- Change all "lib/" references to "frontend/lib/"
- Change all "types/" references to "frontend/types/"
- Change all "public/" references to "frontend/public/"
- Update "Where to Add New Code" section
- Update path alias documentation: "@/*" now maps to "frontend/*"

**ARCHITECTURE.md:**
- Update all layer Location fields to include "frontend/" prefix
- Update Entry Points section paths

**CONVENTIONS.md:**
- Update "Path Aliases" section: "@/*" maps to "frontend/*"
- Update example imports to show new structure

**TESTING.md:**
- Update test file location examples to include "frontend/" prefix
- Update setup file reference to "frontend/vitest.setup.ts"

**STACK.md:**
- Update "Build" configuration section to note tsconfig.json now references frontend/
- Update vitest.config.ts description
</instruction>
<verification>
Run: `grep -r "app/" .planning/codebase/*.md | grep -v "frontend/app" | grep -v "App Router"` - Should return empty (all app/ references updated to frontend/app/)
Verify: Each .planning/codebase/*.md file mentions frontend/ directory structure
</verification>
</task>

## Verification Criteria

1. **Structure:** `ls frontend/` shows app/, components/, contexts/, lib/, types/, public/, vitest.setup.ts, next-env.d.ts
2. **Build:** `npm run build` completes without errors
3. **Tests:** `npm test` passes all 16 test files
4. **Lint:** `npm run lint` completes without errors
5. **TypeScript:** `npx tsc --noEmit` completes without errors
6. **Documentation:** All .planning/codebase/*.md files reference frontend/ paths

## Success Criteria

- All Next.js source files exist under frontend/ directory
- Frontend builds successfully (`npm run build` exits 0)
- All tests pass (`npm test` exits 0)
- Development server runs and renders all three demo pages
- Import paths (@/*) resolve correctly to frontend/*
- Documentation reflects new structure
